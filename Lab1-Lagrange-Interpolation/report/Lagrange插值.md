## 实验题目：拉格朗日（Lagrange）插值

### 问题分析

1. 利用拉格朗日插值算法，根据参考程序流程实现算法，利用多项式$P_n(x)$来求$f(x)$的近似值。
2. 通过对具体实例的分析探索插值多项式次数对结果的影响
3. 通过对具体实例的分析探索插值区间大小对结果的影响
4. 理解插值问题的内插与外推的方法，对两者可靠性进行比较

### 数学原理

#### 插值基函数

令插值基函数 $ l_j(x)\, (j = 0,1,2,...,n)$ 为如下的多项式：
$$
l_j(x)=

\begin{cases}

0, & i\ne j \\
1,& i = j

\end{cases}
$$

####    Lagrange插值公式

显然存在某多项式
$$
\begin{equation}
y(x) = \sum_\limits{j = 0}^\limits{n} f(x_j)l_j(x) \tag{1}
\end{equation}
$$
满足插值条件，$l_j(x)$ 有 $n$ 个零点 $x_0,x_1,x_2,...,x_{j-1},x{j+1},... ,x_n$ ，所以应当具有形式
$$
l_j(x) = A_j(x-x_0)(x-x_1)...(x-x_{j-1})(x-x_{j+1})...(x-x_n),
$$
结合$l_j(x_j) = 1$ 可求得 $A_j$，综合得
$$
l_j(x) = \frac{(x-x_0)(x-x_1)...(x-x_{j-1})(x-x_{j+1})...(x-x_n)}{(x_j-x_0)(x_j-x_1)...(x_j-x_{j-1})(x_j-x_{j+1})...(x_j-x_n)}, \quad j = 0,1,2,...,n  \tag{2}
$$

其中式（1）称为Lagrange插值公式，式（2）称为 Lagrange 插值多项式，记作 $L_n(x)$

### 程序设计流程

#### 流程图

<img src="E:\projects\Numerical_Analysis\Lab1-Lagrange-Interpolation\report\Lagrange插值.assets\image-20220419225908318.png" alt="image-20220419225908318" style="zoom: 67%;" />

#### 代码

##### 函数实现

```matlab
%-----------------------file name: Lagrange_vec--------------------
function v = lagrange_vec(x_in, y_in, u)
n = length(x_in);
v = zeros(size(u));
for k = 1:n
    w = ones(size(u));
    for j = [1:k-1 k+1:n] %除去它自己不要乘
        w = (u-x_in(j))./(x_in(k)-x_in(j)).*w; %Lagrange多项式
    end
    v = v + w*y_in(k);
end
```

##### 交互脚本

```matlab
%-----------------------file name: Lagrange_vec_interactive------------------
syms x;
format long;
n = input('多项式的次数n：');
u = input('请输入待估值点序列u的值(例如:[1,2,3,4])：');
a = input('请输入区间下界a的值：');
b = input('请输入区间上界b的值：');
f = input('请输入函数f(x)的表达式(如1+x^2）：');
x = linspace(a,b,n);
y = subs(f, symvar(f), x);
lagrange_vec(x,y,u);
ans = lagrange_vec(x,y,u);
exact_value = subs(f,symvar(f),u);
fprintf('\t\t\t结果表格\n');
fprintf('--------------------------------------------------------------------\n');
fprintf('\t    u \t   f(u) \t\t   exact \t\t   error\n');
fprintf('\t %2.3f \t %2.9f \t %2.9f\t %2.9f\n ',[u;ans;exact_value;exact_value-ans]);

```



###### 

### 实验结果、结论与讨论

##### 问题1

拉格朗日插值多项式的次数n越大越好吗？

###### 输出结果：

* 1.(1) $f(x) = {1\over1+x^2}$

```
			       结果表格(n=5)
----------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 0.750 	 0.905441810 	 0.640000000	 -0.265441810
 	 1.750 	 0.525799901 	 0.246153846	 -0.279646054
 	 2.750 	 0.009553216 	 0.116788321	 0.107235105
 	 3.750 	 -0.356826094 	 0.066390041	 0.423216136
 	 4.750 	 -0.159544927 	 0.042440318	 0.201985245
					结果表格(n=10)
-----------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 0.750 	 0.690717622 	 0.640000000	 -0.050717622
 	 1.750 	 0.232998135 	 0.246153846	 0.013155711
 	 2.750 	 0.112245498 	 0.116788321	 0.004542823
 	 3.750 	 0.108400418 	 0.066390041	 -0.042010377
 	 4.750 	 -0.236036985 	 0.042440318	 0.278477303
 	 
 	 			    结果表格(n=20)
----------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 0.750 	 0.641340347 	 0.640000000	 -0.001340347
 	 1.750 	 0.249055753 	 0.246153846	 -0.002901907
 	 2.750 	 0.128218767 	 0.116788321	 -0.011430446
 	 3.750 	 0.190261670 	 0.066390041	 -0.123871629
 	 4.750 	 6.415032061 	 0.042440318	 -6.372591743
```

* 1.(2) $f(x) = e^x$

```
					结果表格(n=5)
----------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -0.95 	 0.386293876 	 0.386741023	 0.000447148
 	 -0.05 	 0.951334528 	 0.951229425	 -0.000105103
 	 0.05 	 1.051164240 	 1.051271096	 0.000106857
 	 0.95 	 2.586322530 	 2.585709659	 -0.000612871
		        	结果表格(n=10)
----------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -0.95 	 0.386741027 	 0.386741023	 -0.000000003
 	 -0.05 	 0.951229425 	 0.951229425	 -0.000000000
 	 0.05 	 1.051271096 	 1.051271096	 -0.000000000
 	 0.95 	 2.585709663 	 2.585709659	 -0.000000004
        			结果表格(n=20)
----------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -0.95 	 0.386741023 	 0.386741023	 0.000000000
 	 -0.05 	 0.951229425 	 0.951229425	 0.000000000
 	 0.05 	 1.051271096 	 1.051271096	 0.000000000
 	 0.95 	 2.585709659 	 2.585709659	 0.000000000
```



###### 回答：不是，次数过高的话会出现Runge现象,使用[切比雪夫节点](https://zh.wikipedia.org/w/index.php?title=切比雪夫节点&action=edit&redlink=1)代替等距点可以减小震荡，在这种情况下，随着多项式阶次的增加最大误差逐渐减小。这个现象表明高阶多项式通常不适合用于插值。使用分段多项式[样条](https://zh.wikipedia.org/wiki/样条)可以避免这个问题。如果要减小插值误差，那么可以增加构成样条的多项式的数目，而不必是增加多项式的阶次。

> 参考：[维基百科：龙格现象](https://zh.wikipedia.org/wiki/%E9%BE%99%E6%A0%BC%E7%8E%B0%E8%B1%A1)

##### 问题2

插值区间越小越好吗?

###### 输出结果

* 2.(1)

```
		           	结果表格(n=5)
---------------------------------------------------------  
	    u 	   f(u) 		   exact 		   error
	 -0.95 	 0.513552500 	 0.525624179	 0.012071679
 	 -0.05 	 0.997752500 	 0.997506234	 -0.000246266
 	 0.05 	 0.997752500 	 0.997506234	 -0.000246266
 	 0.95 	 0.513552500 	 0.525624179	 0.012071679
 	 
 	 				结果表格(n=10)
---------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -0.95 	 0.524273975 	 0.525624179	 0.001350204
 	 -0.05 	 0.997464702 	 0.997506234	 0.000041533
 	 0.05 	 0.997464702 	 0.997506234	 0.000041533
 	 0.95 	 0.524273975 	 0.525624179	 0.001350204
 	 
 	 				结果表格(n=20)
---------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -0.95 	 0.525631202 	 0.525624179	 -0.000007023
 	 -0.05 	 0.997506234 	 0.997506234	 0.000000000
 	 0.05 	 0.997506234 	 0.997506234	 0.000000000
 	 0.95 	 0.525631202 	 0.525624179	 -0.000007023
```

* 2.(2)

	

```
			       结果表格(n=5)
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -4.75 	 -1.932149264 	 0.008651695	 1.940800959
 	 -0.25 	 1.427537021 	 0.778800783	 -0.648736238
 	 0.25 	 0.588185464 	 1.284025417	 0.695839953
 	 4.75 	 123.714558835 	 115.584284527	 -8.130274308
 	 				结果表格(n=10)
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -4.75 	 0.042515959 	 0.008651695	 -0.033864263
 	 -0.25 	 0.779562066 	 0.778800783	 -0.000761282
 	 0.25 	 1.284820075 	 1.284025417	 -0.000794659
 	 4.75 	 115.663039200 	 115.584284527	 -0.078754673
 	 				结果表格(n=20)
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	 -4.75 	 0.008651704 	 0.008651695	 -0.000000009
 	 -0.25 	 0.778800783 	 0.778800783	 0.000000000
 	 0.25 	 1.284025417 	 1.284025417	 0.000000000
 	 4.75 	 115.584284542 	 115.584284527	 -0.000000014
```

###### 回答：不一定，虽然从精度上考虑是区间变窄具有一定的合理性，但是过于密集时舍入误差被放大，而且计算量成本也大幅增加，但是却对精度的提升不大。实际计算时应当合理考虑，取合适的区间长度进行插值。

##### 问题4

考虑拉格朗日插值问题，内插比外推更可靠吗？

###### 结果输出

```
				（1）结果表格 x_in = [1,4,9]
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	  5.00 	 2.266666667 	 2.236067977	 -0.030598689
 	 50.00 	 -20.233333333 	 7.071067812	 27.304401145
     115.00  -171.900000000  10.723805295	 182.623805295
     185.00  -492.733333333  13.601470509	 506.334803842
     
				（2）结果表格 x_in = [36,49,64]
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	  5.00 	 3.115750916 	 2.236067977	 -0.879682938
 	 50.00 	 7.071794872 	 7.071067812	 -0.000727060
 	 115.00  10.167032967 	 10.723805295	 0.556772328
 	 185.00  10.038827839 	 13.601470509	 3.562642670
 	 			
                （3）结果表格 x_in = [100,115,185]
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	  5.00 	 4.537585505 	 2.236067977	 -2.301517527
 	 50.00 	 7.314155736 	 7.071067812	 -0.243087924
 	 115.00  10.723805295 	 10.723805295	 0.000000000
 	 185.00  13.601470509 	 13.601470509	 0.000000000
 	 
 	 
				（4）结果表格 x_in = [169,196,225]
------------------------------------------------------------
	    u 	   f(u) 		   exact 		   error
	  5.00 	 5.497172049 	 2.236067977	 -3.261104071
 	 50.00 	 7.800127714 	 7.071067812	 -0.729059902
 	 115.00  10.800492611 	 10.723805295	 -0.076687316
 	 185.00  13.600620325 	 13.601470509	 0.000850184
```

###### 回答：不一定，取决于具体函数的形式，但通常来说连续函数内插的可靠程度更高。外推相当于根据已知点推测未知点的信息。而我们的已知区间内是不含有区间外的信息的。从上述结果也可以看出，当需要推测的点落在 $x{\_in}$ 的内部时，$error$ 的值就会非常的小，精度明显比外推情况更高